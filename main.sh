#!/bin/bash                                                                                                 clear                                                                                                       GREEN='\033[0;32m'                                                                                          CYAN='\033[0;36m'                                                                                           BLUE='\033[0;34m'                                                                                           NC='\033[0m' # No Color                                                                                     RED='\033[0;31m'                                                                                            LANGUAGE="ru"                                                                                                                                                                                                           print_gradient() {                                                                                              local text="$1"                                                                                             local len=${#text}                                                                                          for ((i = 0; i < len; i++)); do                                                                                 r=$((255 - i * 255 / len))                                                                                  g=$((255))                                                                                                  b=$((i * 255 / len))                                                                                        printf "\033[38;2;%d;%d;%dm%s" "$r" "$g" "$b" "${text:$i:1}"                                            done                                                                                                        echo -e "${NC}"                                                                                         }                                                                                                                                                                                                                       print_banner_gradient() {                                                                                       if [[ -f "banner3.txt" ]]; then                                                                                 while IFS= read -r line; do                                                                                     print_gradient "$line"                                                                                  done < "banner3.txt"                                                                                    else                                                                                                            print_gradient "banner3.txt не найден"                                                                  fi                                                                                                          echo " "                                                                                                }                                                                                                                                                                                                                       search_csv_txt() {                                                                                              local file="$1"                                                                                             local search_text="$2"                                                                                      grep -i "$search_text" "$file" 2>/dev/null                                                              }                                                                                                                                                                                                                       search_db() {                                                                                                   local db_file="$1"                                                                                          local search_text="$2"                                                                                      sqlite3 "$db_file" "SELECT * FROM table_name WHERE column_name LIKE '%$search_text%';" 2>/dev/null      }                                                                                                                                                                                                                       save_results() {                                                                                                local results="$1"                                                                                          print_gradient "Введите имя файла для сохранения результатов:"                                              read filename                                                                                               print_gradient "Выберите формат файла (txt/csv):"                                                           select format in "txt" "csv"; do                                                                                if [[ -n "$format" ]]; then                                                                                     filename="$filename.$format"                                                                                echo "$results" > "$filename"                                                                               print_gradient "Результаты сохранены в файл $filename"                                                      break                                                                                                   else                                                                                                            print_gradient "Некорректный выбор. Попробуйте снова."                                                  fi                                                                                                      done                                                                                                    }                                                                                                                                                                                                                       show_progress() {                                                                                               local current="$1"                                                                                          local total="$2"                                                                                            local width=20                                                                                              local percent=$((current * 100 / total))                                                                    local completed=$((width * current / total))                                                                local bar=""                                                                                                for ((i = 0; i < width; i++)); do                                                                               if [[ $i -lt $completed ]]; then                                                                                bar="${bar}${GREEN}█"                                                                                   else                                                                                                            bar="${bar}-"                                                                                           fi                                                                                                      done                                                                                                        printf "\r${GREEN}[${bar}${NC}] %d%%" "$percent"                                                        }                                                                                                                                                                                                                       basa_data() {                                                                                                   clear                                                                                                       print_banner_gradient                                                                                       print_gradient "Запуск ml_db"                                                                                                                                                                                           BASE_DIRS=("bas")                                                                                                                                        while true; do                                                                                                  print_gradient "Вы хотите искать по всем базам данных? (да/нет)"                                            read search_all                                                                                                                                                                                                         if [[ "$search_all" == "да" ]]; then                                                                            db_list=()                                                                                                  for dir in "${BASE_DIRS[@]}"; do                                                                                if [[ -d "$dir" ]]; then                                                                                        db_list+=("$dir"/*)                                                                                     fi                                                                                                      done                                                                                                        print_gradient "Поиск будет выполнен по всем базам данных."                                             else                                                                                                            print_gradient "Выберите базу данных (или 'xx' для выхода):"                                                select db_dir in "${BASE_DIRS[@]}"; do                                                                          if [[ "$REPLY" == "xx" ]]; then                                                                                 print_gradient "Возврат в главное меню."                                                                    break 2                                                                                                 elif [[ -n "$db_dir" ]]; then                                                                                   db_list=("$db_dir"/*)                                                                                       print_gradient "Вы выбрали $db_dir"                                                                         break                                                                                                   else                                                                                                            print_gradient "Некорректный выбор."                                                                    fi                                                                                                      done                                                                                                    fi                                                                                                                                                                                                                      print_gradient "Введите текст для поиска (или 'xx' для выхода):"                                            read searchText                                                                                                                                                                                                         if [[ "$searchText" == "xx" ]]; then                                                                            print_gradient "Возврат в главное меню."                                                                    break                                                                                                   fi                                                                                                                                                                                                                      temp_dir=""                                                                                                 all_results=""                                                                                              total_steps=0                                                                                               current_step=0                                                                                                                                                                                                          for db in "${db_list[@]}"; do                                                                                   if [[ "${db##*.}" == "zip" ]]; then                                                                             mapfile -t files_in_zip < <(unzip -Z1 "$db" 2>/dev/null)                                                    total_steps=$((total_steps + ${#files_in_zip[@]}))                                                      else                                                                                                            total_steps=$((total_steps + 1))                                                                        fi                                                                                                      done                                                                                                                                                                                                                    for db in "${db_list[@]}"; do                                                                                   if [[ "${db##*.}" == "zip" ]]; then                                                                             temp_dir=$(mktemp -d)                                                                                       mapfile -t files_in_zip < <(unzip -Z1 "$db" 2>/dev/null)                                                                                                                                                                for file_in_zip in "${files_in_zip[@]}"; do                                                                     unzip -p "$db" "$file_in_zip" > "$temp_dir/$file_in_zip" 2>/dev/null                                        file_path="$temp_dir/$file_in_zip"                                                                          file_extension="${file_in_zip##*.}"                                                                                                                                                                                     case "$file_extension" in                                                                                       "csv"|"txt"|"drl")                                                                                              result=$(search_csv_txt "$file_path" "$searchText")                                                         ;;                                                                                                      "db")                                                                                                           result=$(search_db "$file_path" "$searchText")                                                              ;;                                                                                                      *)                                                                                                              continue                                                                                                    ;;                                                                                                  esac                                                                                                                                                                                                                    if [[ -n "$result" ]]; then                                                                                     all_results+="$result"$'\n'                                                                             fi                                                                                                          current_step=$((current_step + 1))                                                                          show_progress "$current_step" "$total_steps"                                                            done                                                                                                        rm -rf "$temp_dir"                                                                                      else                                                                                                            file_extension="${db##*.}"                                                                                  case "$file_extension" in                                                                                       "csv"|"txt"|"drl")                                                                                              result=$(search_csv_txt "$db" "$searchText")                                                                ;;                                                                                                      "db")                                                                                                           result=$(search_db "$db" "$searchText")                                                                     ;;                                                                                                      *)                                                                                                              continue                                                                                                    ;;                                                                                                  esac                                                                                                                                                                                                                    if [[ -n "$result" ]]; then                                                                                     all_results+="$result"$'\n'                                                                             fi                                                                                                          current_step=$((current_step + 1))                                                                          show_progress "$current_step" "$total_steps"                                                            fi                                                                                                      done                                                                                                                                                                                                                    echo ""                                                                                                                                                                                                                 if [[ -n "$all_results" ]]; then                                                                                echo "$all_results"                                                                                         print_gradient "Нажмите 'p' для сохранения результатов или Enter для продолжения:"                          read -n1 save_choice                                                                                        echo ""                                                                                                     if [[ "$save_choice" == "p" ]]; then                                                                            save_results "$all_results"                                                                             fi                                                                                                      else                                                                                                            print_gradient "Ничего не найдено."                                                                     fi                                                                                                      done                                                                                                    }                                                                                                                                                                                                                       settings_menu() {                                                                                               while true; do                                                                                                  clear                                                                                                       print_banner_gradient                                                                                       if [[ "$LANGUAGE" == "ru" ]]; then                                                                              print_gradient "Настройки:"                                                                                 print_gradient "1. Поменять цвета градиента"                                                                print_gradient "2. Переключить язык (русский/английский)"                                                   print_gradient "3. Просмотр занятой памяти базами"                                                          print_gradient "4. Поменять баннер"                                                                         print_gradient "5. Вернуть стандартный баннер"                                                              print_gradient "xx. Вернуться в главное меню"                                                               print_gradient "\/"                                                                                     else                                                                                                            print_gradient "Settings:"                                                                                  print_gradient "1. Change gradient colors"                                                                  print_gradient "2. Toggle language (Russian/English)"                                                       print_gradient "3. View memory usage by databases"                                                          print_gradient "4. Change banner"                                                                           print_gradient "5. Restore default banner"                                                                  print_gradient "xx. Return to main menu"                                                                    print_gradient "\/"                                                                                     fi                                                                                                          read option                                                                                                                                                                                                             case $option in                                                                                                 1)                                                                                                              clear                                                                                                       print_banner_gradient                                                                                       change_gradient_colors                                                                                      ;;                                                                                                      2)                                                                                                              clear                                                                                                       print_banner_gradient                                                                                       toggle_language                                                                                             ;;                                                                                                      3)                                                                                                              clear                                                                                                       print_banner_gradient                                                                                       view_memory_usage                                                                                           ;;                                                                                                      4)                                                                                                              clear                                                                                                       print_banner_gradient                                                                                       change_banner                                                                                               ;;                                                                                                      5)                                                                                                              clear                                                                                                       print_banner_gradient                                                                                       restore_default_banner                                                                                      ;;                                                                                                      xx)                                                                                                             break                                                                                                       ;;                                                                                                      *)                                                                                                              echo -e "${RED}Некорректный выбор, попробуйте снова.${NC}"                                                  ;;                                                                                                  esac                                                                                                    done                                                                                                    }                                                                                                                                                                                                                       change_gradient_colors() {                                                                                      if [[ "$LANGUAGE" == "ru" ]]; then                                                                              print_gradient "Введите новые значения для градиента (r, g, b):"                                        else                                                                                                            print_gradient "Enter new gradient values (r, g, b):"                                                   fi                                                                                                          read r g b                                                                                                  GREEN="\033[38;2;${r};${g};${b}m"                                                                           if [[ "$LANGUAGE" == "ru" ]]; then                                                                              print_gradient "Цвета градиента изменены."                                                              else                                                                                                            print_gradient "Gradient colors changed."                                                               fi                                                                                                      }                                                                                                                                                                                                                       toggle_language() {                                                                                             if [[ "$LANGUAGE" == "ru" ]]; then                                                                              LANGUAGE="en"                                                                                               print_gradient "Language changed to English."                                                           else                                                                                                            LANGUAGE="ru"                                                                                               print_gradient "Язык изменён на русский."                                                               fi                                                                                                      }                                                                                                                                                                                                                       view_memory_usage() {                                                                                           if [[ "$LANGUAGE" == "ru" ]]; then                                                                              print_gradient "Занятая память базами данных:"                                                          else                                                                                                            print_gradient "Memory usage by databases:"                                                             fi                                                                                                          du -sh basa/*                                                                                           }                                                                                                                                                                                                                       change_banner() {                                                                                               if [[ "$LANGUAGE" == "ru" ]]; then                                                                              print_gradient "Введите новый текст баннера:"                                                           else                                                                                                            print_gradient "Enter new banner text:"                                                                 fi                                                                                                          read new_banner                                                                                             cp banner3.txt banner3_backup.txt                                                                           echo "$new_banner" > banner3.txt                                                                            if [[ "$LANGUAGE" == "ru" ]]; then                                                                              print_gradient "Баннер изменён."                                                                        else                                                                                                            print_gradient "Banner changed."                                                                        fi                                                                                                      }                                                                                                                                                                                                                       restore_default_banner() {                                                                                      if [[ -f "banner3_backup.txt" ]]; then                                                                          mv banner3_backup.txt banner3.txt                                                                           if [[ "$LANGUAGE" == "ru" ]]; then                                                                              print_gradient "Стандартный баннер восстановлен."                                                       else                                                                                                            print_gradient "Default banner restored."                                                               fi                                                                                                      else                                                                                                            if [[ "$LANGUAGE" == "ru" ]]; then                                                                              print_gradient "Резервная копия баннера не найдена."                                                    else                                                                                                            print_gradient "Backup banner not found."                                                               fi                                                                                                      fi                                                                                                      }                                                                                                                                                                                                                       main_menu() {                                                                                                   while true; do                                                                                                  clear                                                                                                       print_banner_gradient                                                                                       if [[ "$LANGUAGE" == "ru" ]]; then                                                                              print_gradient "Главное меню:"                                                                              print_gradient "1. Работа с базами SQL"                                                                     print_gradient "2. Обычный режим"                                                                           print_gradient "3. Настройки"                                                                               print_gradient "xx. Выход в оболочку"                                                                       print_gradient "\/"                                                                                     else                                                                                                            print_gradient "Main Menu:"                                                                                 print_gradient "1. Work with SQL databases"                                                                 print_gradient "2. Normal mode"                                                                             print_gradient "3. Settings"                                                                                print_gradient "xx. Exit to shell"                                                                          print_gradient "\/"                                                                                     fi                                                                                                          read option                                                                                                                                                                                                             case $option in                                                                                                 1)                                                                                                              clear                                                                                                       print_banner_gradient                                                                                       sqlite3                                                                                                     ;;                                                                                                      2)                                                                                                              clear                                                                                                       print_banner_gradient                                                                                       basa_data                                                                                                   ;;                                                                                                      3)                                                                                                              clear                                                                                                       print_banner_gradient                                                                                       settings_menu                                                                                               ;;                                                                                                      xx)                                                                                                             exit 0                                                                                                      ;;                                                                                                      *)                                                                                                              echo -e "${RED}Некорректный выбор, попробуйте снова.${NC}"                                                  ;;                                                                                                  esac                                                                                                    done                                                                                                    }                                                                                                                                                                                                                       main_menu
